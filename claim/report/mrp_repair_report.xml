<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_mrp_repairorder_claim" inherit_id="mrp_repair.report_mrprepairorder">
        <!-- Related claim Name -->
        <xpath expr="//div[@class='row mt32 mb32']" position="inside">
        </xpath>
        <!--- Customer reference -->
        <xpath expr="//div[@class='row mt32 mb32']" position="inside">
        </xpath>
        <!-- Header Text -->
        <xpath expr="//table[@class='table table-condensed']" position="before">
            <t t-if="o.header_text">
                <p t-raw="o.header_text" />
            </t>
        </xpath>
        <!-- Footer Text -->
        <xpath expr="//table[@class='table table-condensed']" position="after">
            <t t-if="o.footer_text">
                <p t-raw="o.footer_text" />
            </t>
        </xpath>
        <!-- Make product and Lot bigger, manage header with infos -->
        <xpath expr="//div[@class='row mt32 mb32']" position="replace">
            <div class="row mt-32">
                <div t-if="o.product_id" class="h5 col-xs-12">
                    <strong>Product to Repair:</strong>
                    <span t-field="o.product_id.name"/>
                </div>
                <div t-if="o.lot_id" class="h5 col-xs-12" groups="stock.group_production_lot">
                    <strong>Lot/Serial Number:</strong>
                    <span t-field="o.lot_id.name"/>
                </div>
            </div>
            <div class="row mt32 mb32" id="informations">
                <div t-if="o.guarantee_limit" class="col-xs-3">
                    <strong>Warranty:</strong>
                    <p t-field="o.guarantee_limit"/>
                </div>
                <div class="col-xs-3">
                    <strong>Date:</strong>
                    <p t-esc="datetime.datetime.now().strftime('%Y-%m-%d')" t-options="{'widget': 'date'}"/>
                </div>
                <div t-if="o.claim_id" class="col-xs-3">
                    <strong>Related claim:</strong>
                    <p t-field="o.claim_id.name"/>
                </div>
                <div t-if="o.customer_reference" class="col-xs-3">
                    <strong>Customer reference:</strong>
                    <p t-field="o.customer_reference"/>
                </div>
            </div>
        </xpath>

        <xpath expr="//div[@class='row'][1]" position="replace">
            <!-- Delivery and Invoicing are different -->
            <t t-if="o.delivery_address != o.partner_invoice_id">
                <div t-if="o.delivery_address" class="col-xs-6">
                    <strong>Shipping address:</strong>
                    <h5 t-field="o.delivery_address" t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
                </div>
                <div class="col-xs-6">
                    <strong>Invoicing address:</strong>
                    <h5 t-field="o.partner_invoice_id" t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
                    <p t-if="o.partner_invoice_id.vat"><t t-esc="o.company_id.country_id.vat_label or 'TIN'"/>: <span t-field="o.partner_invoice_id.vat"/></p>
                </div>
            </t>

            <!-- Delivery and Invoicing are equals -->
            <t t-if="o.delivery_address == o.partner_invoice_id">
                <div class="col-xs-5 col-xs-offset-6">
                    <strong>Invoicing and shipping address:</strong>
                    <h5 t-field="o.partner_invoice_id" t-options="{'widget': 'contact', 'fields': ['address', 'name'], 'no_marker': True}"/>
                    <p t-if="o.partner_invoice_id.vat"><t t-esc="o.company_id.country_id.vat_label or 'TIN'"/>: <span t-field="o.partner_invoice_id.vat"/></p>
                </div>
            </t>
        </xpath>
    </template>
</odoo>
